const { Client, LocalAuth } = require('whatsapp-web.js');
const qrcode = require('qrcode-terminal');

const client = new Client({
    authStrategy: new LocalAuth({
        dataPath: 'yourFolderName',
    }),
});

client.on('ready', () => {
    console.log('WhatsApp Conectado!');
});

client.on('qr', (qr) => {
    qrcode.generate(qr, { small: true });
});

client.initialize();

const delay = (ms) => new Promise((res) => setTimeout(res, ms)); // Criando o delay

const iPhoneLinksCapa = {
    '1':'https://produto.mercadolivre.com.br/MLB-5205225080-capa-capinha-case-aveludada-iphone-xr-_JM',
    '01':'https://produto.mercadolivre.com.br/MLB-5205225080-capa-capinha-case-aveludada-iphone-xr-_JM',
    '2': 'https://produto.mercadolivre.com.br/MLB-5207197000-capa-capinha-case-aveludada-iphone-11-_JM',
    '02': 'https://produto.mercadolivre.com.br/MLB-5207197000-capa-capinha-case-aveludada-iphone-11-_JM',
    '3': '',
    '03': '',
    '4':'',
    '04':'',
    '5':'https://produto.mercadolivre.com.br/MLB-3924980501-capa-capinha-case-aveludada-iphone-12-_JM?variation=186283407509#reco_item_pos=1&reco_backend=same-seller-odin&reco_backend_type=low_level&reco_client=vip-seller_items-above&reco_id=c61372e7-5c87-4d98-9b23-c479b81778c5&reco_model=machinalis-sellers-baseline',
    '05':'https://produto.mercadolivre.com.br/MLB-3924980501-capa-capinha-case-aveludada-iphone-12-_JM?variation=186283407509#reco_item_pos=1&reco_backend=same-seller-odin&reco_backend_type=low_level&reco_client=vip-seller_items-above&reco_id=c61372e7-5c87-4d98-9b23-c479b81778c5&reco_model=machinalis-sellers-baseline',
    '8':'https://produto.mercadolivre.com.br/MLB-3924988711-capa-capinha-case-aveludada-iphone-13-_JM',
    '08':'https://produto.mercadolivre.com.br/MLB-3924988711-capa-capinha-case-aveludada-iphone-13-_JM'

    // Adicione mais links para outras op√ß√µes conforme necess√°rio
};

const iPhoneLinksPelicula = {
    '1':'https://produto.mercadolivre.com.br/MLB-5205439100-pelicula-vidro-temperado-3d-iphone-xr-11-12-13-14-15-pro-max-_JM',
    '01':'https://produto.mercadolivre.com.br/MLB-5205439100-pelicula-vidro-temperado-3d-iphone-xr-11-12-13-14-15-pro-max-_JM',
    '2':'https://produto.mercadolivre.com.br/MLB-5219239596-pelicula-fosca-privacidade-iphone-xr-11-12-13-14-15-pro-max-_JM',
    '02':'https://produto.mercadolivre.com.br/MLB-5219239596-pelicula-fosca-privacidade-iphone-xr-11-12-13-14-15-pro-max-_JM'
};


let state = {}; // Objeto para gerenciar estados dos usu√°rios

client.on('message_create', async (message) => {
    const user = message.from; // Identifica o usu√°rio pelo n√∫mero
    const chat = await message.getChat();

    // Sauda√ß√µes
    if (message.body==='00' || message.body.match(/(Ola|ol√°|oi|Oi|Bom dia|bom dia|Boa tarde|boa tarde|Boa noite|boa noite)/i) && message.from.endsWith('@c.us')) {
        await delay(2000);
        await chat.sendStateTyping(); // Simulando digita√ß√£o
        await delay(2000);

        const contact = await message.getContact(); // Pegando o contato
        const name = contact.pushname; // Pegando o nome do Contato

        await client.sendMessage(
            message.from,
            'Bem vindo,' +
            name.split(' ')[0] +
            '! üëã' +
            '\nSou o assistente virtual da empreendimentocruz. Como posso te ajudar ?\nüåü*MENU*:\n\n1Ô∏è‚É£Capa iPhone\n2Ô∏è‚É£Pel√≠cula iPhone\n' +
            '\nPor favor, responda com n√∫mero da op√ß√£o desejada.'
        );
        state[user] = 'menu'; // Define o estado do usu√°rio
        return;
    }

    // Op√ß√£o de Capa iPhone
    if (message.body === '1' && state[user] === 'menu') {
        await delay(2000);
        await chat.sendStateTyping();
        await delay(2000);

        await client.sendMessage(
            message.from,
            '*CAPA IPHONE*üì±\nüìã*MENU MODELO IPHONE*:\n\n' +
            '0Ô∏è‚É£1Ô∏è‚É£iPhone XR\n0Ô∏è‚É£2Ô∏è‚É£iPhone 11\n0Ô∏è‚É£3Ô∏è‚É£iPhone 11 Pro\n' +
            '0Ô∏è‚É£4Ô∏è‚É£iPhone 11 Pro Max\n0Ô∏è‚É£5Ô∏è‚É£iPhone 12\n0Ô∏è‚É£6Ô∏è‚É£iPhone 12 Pro\n' +
            '0Ô∏è‚É£7Ô∏è‚É£iPhone 12 Pro Max\n0Ô∏è‚É£8Ô∏è‚É£iPhone 13\n0Ô∏è‚É£9Ô∏è‚É£iPhone 13 Pro\n' +
            '1Ô∏è‚É£0Ô∏è‚É£iPhone 13 Pro Max\n1Ô∏è‚É£1Ô∏è‚É£iPhone 14\n1Ô∏è‚É£2Ô∏è‚É£iPhone 14 Pro\n' +
            '1Ô∏è‚É£3Ô∏è‚É£iPhone 14 Pro Max\n1Ô∏è‚É£4Ô∏è‚É£iPhone 15\n1Ô∏è‚É£5Ô∏è‚É£iPhone 15 Pro\n' +
            '1Ô∏è‚É£6Ô∏è‚É£iphone 15 Pro Max\n'+
            '\n0Ô∏è‚É£0Ô∏è‚É£MENU\n'+
            '\nPor favor, responda com n√∫mero da op√ß√£o desejada.'
        );
        state[user] = 'modelosCapa'; // Atualiza o estado do usu√°rio
        return;
    }
    // Link do modelo Capa selecionado
        if (state[user] === 'modelosCapa' && message.body in iPhoneLinksCapa) {
        const siteLink = iPhoneLinksCapa[message.body];

            await delay(2000);
            await chat.sendStateTyping();
            await delay(2000);

        await client.sendMessage(message.from, `Segue o link para o modelo escolhido: ${siteLink}`);
        state[user] = null; // Reseta o estado do usu√°rio
        return;
        }

    // Op√ß√£o de Pelicula iPhone
    else if (message.body === '2' && state[user] === 'menu') {
        await delay(2000);
        await chat.sendStateTyping();
        await delay(2000);

        await client.sendMessage(
            message.from,
            '*PEL√çCULA IPHONE*üì±\nüìã*MENU MODELO IPHONE*:\n\n' +
            '0Ô∏è‚É£1Ô∏è‚É£Pel√≠cula Vidro Temperado 3D\n0Ô∏è‚É£2Ô∏è‚É£Pel√≠cula Fosca Privacidade\n' +
            '\n0Ô∏è‚É£0Ô∏è‚É£MENU\n'+
            '\nPor favor, responda com n√∫mero da op√ß√£o desejada.'
        );
        state[user] = 'modelosPelicula'; // Atualiza o estado do usu√°rio
        return;
    }
        // Link do modelo Capa selecionado
        if (state[user] === 'modelosPelicula' && message.body in iPhoneLinksPelicula) {
            const siteLink = iPhoneLinksPelicula[message.body];

            await delay(2000);
            await chat.sendStateTyping();
            await delay(2000);

            await client.sendMessage(message.from, `${siteLink}`);
            await client.sendMessage(message.from, 'Para voltar ao menu, selecione\n' +
                '\n0Ô∏è‚É£0Ô∏è‚É£MENU\n');
            state[user] = null; // Reseta o estado do usu√°rio
            return;
        }

        // Caso o usu√°rio n√£o escolha uma op√ß√£o v√°lida
        if (state[user] === 'modelosCapa' || state[user] === 'modelosPelicula') {
            await client.sendMessage(message.from, 'Op√ß√£o inv√°lida. Por favor, escolha uma op√ß√£o v√°lida.');
        }

});
